# QR Code Word Collection Feature - Asocijacije Game

## Overview
This feature allows players to submit custom words for the game using their own devices by scanning a QR code. The host's phone displays a QR code that opens a web page where each player submits exactly 8 words. The game can only start once all players have submitted their required 8 words.

## Architecture

```
[Host's Flutter App] â†â†’ [Firebase Realtime Database] â†â†’ [Web Interface (Any Browser)]
     â”‚                                                          â”‚
     â”‚ - Generates QR code                                     â”‚ - Scans QR code
     â”‚ - Monitors word submissions                             â”‚ - Submits 8 words
     â”‚ - Starts game when ready                                â”‚ - Sees progress
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Requirements

### Strict Mode Rules
- Each player MUST submit exactly 8 words
- Game cannot start until all players have submitted 8 words
- Total words = playerCount Ã— 8
- No early start option

### User Flow

**Host (Flutter App):**
1. Navigate to word collection screen
2. App generates unique session ID and QR code
3. Display QR code and session code
4. Show real-time progress of word submissions
5. "Start Game" button activates only when target reached
6. Collect all words and proceed to game

**Guest (Web Browser):**
1. Scan QR code with phone camera
2. Web page loads with session info
3. Add exactly 8 words one by one
4. Submit button activates when 8 words added
5. Confirmation shown after successful submission

## Implementation Steps

### 1. Firebase Setup

#### 1.1 Create Firebase Project
```bash
# Install Firebase CLI
npm install -g firebase-tools

# Login
firebase login

# Create new project or use existing
firebase projects:create asocijacije-words

# Initialize Firebase in your Flutter project
firebase init
```

#### 1.2 Add Firebase to Flutter App

**pubspec.yaml:**
```yaml
dependencies:
  flutter:
    sdk: flutter
  firebase_core: ^2.24.0
  firebase_database: ^10.4.0
  qr_flutter: ^4.1.0
  uuid: ^4.0.0
  url_launcher: ^6.2.0  # Optional: for testing URLs
```

**Initialize Firebase in main.dart:**
```dart
import 'package:firebase_core/firebase_core.dart';
import 'firebase_options.dart'; // Generated by FlutterFire CLI

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  await Firebase.initializeApp(
    options: DefaultFirebaseOptions.currentPlatform,
  );
  runApp(MyApp());
}
```

#### 1.3 Database Structure

```json
{
  "sessions": {
    "ABC123": {
      "createdAt": 1706635200000,
      "hostId": "device_unique_id",
      "playerCount": 4,
      "status": "collecting",
      "expiresAt": 1706637000000,
      "targetWords": 32,
      "words": {
        "player_xyz123": {
          "words": ["banana", "stolica", "fudbal", "auto", "planina", "more", "nebo", "pas"],
          "submittedAt": 1706635300000,
          "playerName": "Marko"  // Optional
        },
        "player_abc456": {
          "words": ["knjiga", "telefon", "lopata", "drvo", "kafa", "hleb", "voda", "kisa"],
          "submittedAt": 1706635350000,
          "playerName": "Ana"
        }
      }
    }
  }
}
```

#### 1.4 Security Rules

**firebase.rules.json:**
```json
{
  "rules": {
    "sessions": {
      "$sessionId": {
        ".read": true,
        ".write": "!data.exists() || (data.child('status').val() === 'collecting' && data.child('expiresAt').val() > now)",
        ".validate": "newData.hasChildren(['createdAt', 'hostId', 'playerCount', 'status', 'expiresAt', 'targetWords'])",
        "words": {
          "$playerId": {
            ".write": "root.child('sessions').child($sessionId).child('status').val() === 'collecting'",
            ".validate": "newData.hasChildren(['words', 'submittedAt']) && newData.child('words').val().length === 8"
          }
        }
      }
    }
  }
}
```

Deploy rules:
```bash
firebase deploy --only database
```

### 2. Flutter Implementation (Host Side)

#### 2.1 Word Collection Service

**lib/services/word_collection_service.dart:**
```dart
import 'package:firebase_database/firebase_database.dart';
import 'package:uuid/uuid.dart';

class WordCollectionService {
  final DatabaseReference _database = FirebaseDatabase.instance.ref();
  
  /// Create a new word collection session
  Future<String> createSession(int playerCount, String hostId) async {
    // Generate short, readable session ID (6 characters)
    final sessionId = _generateSessionId();
    final sessionRef = _database.child('sessions/$sessionId');
    
    // Check if session already exists (rare collision)
    final snapshot = await sessionRef.get();
    if (snapshot.exists) {
      // Recursively try again with new ID
      return createSession(playerCount, hostId);
    }
    
    // Create session
    await sessionRef.set({
      'createdAt': ServerValue.timestamp,
      'hostId': hostId,
      'playerCount': playerCount,
      'status': 'collecting',
      'expiresAt': DateTime.now().add(Duration(minutes: 30)).millisecondsSinceEpoch,
      'targetWords': playerCount * 8,
      'words': {},
    });
    
    return sessionId;
  }
  
  /// Generate readable 6-character session ID
  String _generateSessionId() {
    const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // Removed ambiguous chars
    final random = Uuid().v4().hashCode;
    String id = '';
    var value = random.abs();
    
    for (int i = 0; i < 6; i++) {
      id += chars[value % chars.length];
      value ~/= chars.length;
    }
    
    return id;
  }
  
  /// Listen to word submissions in real-time
  Stream<SessionState> watchSession(String sessionId) {
    return _database.child('sessions/$sessionId').onValue.map((event) {
      if (!event.snapshot.exists) {
        return SessionState(
          sessionId: sessionId,
          playerCount: 0,
          targetWords: 0,
          submissions: {},
          isReady: false,
        );
      }
      
      final data = Map<String, dynamic>.from(event.snapshot.value as Map);
      final playerCount = data['playerCount'] as int;
      final targetWords = data['targetWords'] as int;
      
      // Parse submissions
      final Map<String, PlayerSubmission> submissions = {};
      if (data.containsKey('words') && data['words'] != null) {
        final wordsData = Map<String, dynamic>.from(data['words'] as Map);
        wordsData.forEach((playerId, playerData) {
          final playerMap = Map<String, dynamic>.from(playerData as Map);
          submissions[playerId] = PlayerSubmission(
            playerId: playerId,
            words: List<String>.from(playerMap['words'] as List),
            submittedAt: DateTime.fromMillisecondsSinceEpoch(playerMap['submittedAt'] as int),
            playerName: playerMap['playerName'] as String?,
          );
        });
      }
      
      // Calculate totals
      int totalWords = 0;
      int playersReady = 0;
      submissions.forEach((_, submission) {
        totalWords += submission.words.length;
        if (submission.words.length == 8) playersReady++;
      });
      
      final isReady = playersReady == playerCount && totalWords == targetWords;
      
      return SessionState(
        sessionId: sessionId,
        playerCount: playerCount,
        targetWords: targetWords,
        submissions: submissions,
        totalWords: totalWords,
        playersReady: playersReady,
        isReady: isReady,
      );
    });
  }
  
  /// Collect all words from a session
  Future<List<String>> collectWords(String sessionId) async {
    final snapshot = await _database.child('sessions/$sessionId/words').get();
    
    if (!snapshot.exists) return [];
    
    final List<String> allWords = [];
    final wordsData = Map<String, dynamic>.from(snapshot.value as Map);
    
    wordsData.forEach((playerId, playerData) {
      final playerMap = Map<String, dynamic>.from(playerData as Map);
      final words = List<String>.from(playerMap['words'] as List);
      allWords.addAll(words);
    });
    
    return allWords;
  }
  
  /// Close session and mark as completed
  Future<void> closeSession(String sessionId) async {
    await _database.child('sessions/$sessionId/status').set('completed');
  }
  
  /// Delete session (cleanup)
  Future<void> deleteSession(String sessionId) async {
    await _database.child('sessions/$sessionId').remove();
  }
}

/// Data class for session state
class SessionState {
  final String sessionId;
  final int playerCount;
  final int targetWords;
  final Map<String, PlayerSubmission> submissions;
  final int totalWords;
  final int playersReady;
  final bool isReady;
  
  SessionState({
    required this.sessionId,
    required this.playerCount,
    required this.targetWords,
    required this.submissions,
    this.totalWords = 0,
    this.playersReady = 0,
    this.isReady = false,
  });
}

/// Data class for player submission
class PlayerSubmission {
  final String playerId;
  final List<String> words;
  final DateTime submittedAt;
  final String? playerName;
  
  PlayerSubmission({
    required this.playerId,
    required this.words,
    required this.submittedAt,
    this.playerName,
  });
}
```

#### 2.2 Word Collection Screen UI

**lib/screens/word_collection_screen.dart:**
```dart
import 'package:flutter/material.dart';
import 'package:qr_flutter/qr_flutter.dart';
import '../services/word_collection_service.dart';

class WordCollectionScreen extends StatefulWidget {
  final int playerCount;
  
  const WordCollectionScreen({
    Key? key,
    required this.playerCount,
  }) : super(key: key);
  
  @override
  State<WordCollectionScreen> createState() => _WordCollectionScreenState();
}

class _WordCollectionScreenState extends State<WordCollectionScreen> {
  final WordCollectionService _service = WordCollectionService();
  String? _sessionId;
  bool _isLoading = true;
  
  @override
  void initState() {
    super.initState();
    _createSession();
  }
  
  Future<void> _createSession() async {
    try {
      final hostId = 'host_${DateTime.now().millisecondsSinceEpoch}'; // Use device ID in production
      final sessionId = await _service.createSession(widget.playerCount, hostId);
      setState(() {
        _sessionId = sessionId;
        _isLoading = false;
      });
    } catch (e) {
      setState(() => _isLoading = false);
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(content: Text('Error creating session: $e')),
      );
    }
  }
  
  @override
  Widget build(BuildContext context) {
    if (_isLoading || _sessionId == null) {
      return Scaffold(
        appBar: AppBar(title: Text('Custom Words')),
        body: Center(child: CircularProgressIndicator()),
      );
    }
    
    final url = 'https://yourapp.web.app/submit/$_sessionId'; // Replace with your URL
    
    return Scaffold(
      appBar: AppBar(
        title: Text('Collect Custom Words'),
        actions: [
          IconButton(
            icon: Icon(Icons.close),
            onPressed: () {
              _service.deleteSession(_sessionId!);
              Navigator.pop(context);
            },
          ),
        ],
      ),
      body: StreamBuilder<SessionState>(
        stream: _service.watchSession(_sessionId!),
        builder: (context, snapshot) {
          if (!snapshot.hasData) {
            return Center(child: CircularProgressIndicator());
          }
          
          final state = snapshot.data!;
          
          return SingleChildScrollView(
            padding: EdgeInsets.all(16),
            child: Column(
              children: [
                // QR Code
                Card(
                  elevation: 4,
                  child: Padding(
                    padding: EdgeInsets.all(16),
                    child: Column(
                      children: [
                        Text(
                          'Scan to Add Words',
                          style: Theme.of(context).textTheme.headlineSmall,
                        ),
                        SizedBox(height: 16),
                        QrImageView(
                          data: url,
                          version: QrVersions.auto,
                          size: 250.0,
                          backgroundColor: Colors.white,
                        ),
                        SizedBox(height: 16),
                        Text(
                          'Session Code: $_sessionId',
                          style: TextStyle(
                            fontSize: 24,
                            fontWeight: FontWeight.bold,
                            letterSpacing: 2,
                          ),
                        ),
                        SizedBox(height: 8),
                        Text(
                          'Each player must add 8 words',
                          style: TextStyle(color: Colors.grey[600]),
                        ),
                      ],
                    ),
                  ),
                ),
                
                SizedBox(height: 24),
                
                // Progress Section
                Card(
                  child: Padding(
                    padding: EdgeInsets.all(16),
                    child: Column(
                      crossAxisAlignment: CrossAxisAlignment.start,
                      children: [
                        Row(
                          mainAxisAlignment: MainAxisAlignment.spaceBetween,
                          children: [
                            Text(
                              'Progress',
                              style: Theme.of(context).textTheme.titleLarge,
                            ),
                            Text(
                              '${state.totalWords} / ${state.targetWords}',
                              style: TextStyle(
                                fontSize: 20,
                                fontWeight: FontWeight.bold,
                                color: state.isReady ? Colors.green : Colors.orange,
                              ),
                            ),
                          ],
                        ),
                        SizedBox(height: 12),
                        LinearProgressIndicator(
                          value: state.totalWords / state.targetWords,
                          minHeight: 10,
                          backgroundColor: Colors.grey[300],
                          color: state.isReady ? Colors.green : Colors.blue,
                        ),
                        SizedBox(height: 8),
                        Text(
                          '${state.playersReady} of ${state.playerCount} players ready',
                          style: TextStyle(color: Colors.grey[600]),
                        ),
                      ],
                    ),
                  ),
                ),
                
                SizedBox(height: 16),
                
                // Player List
                Card(
                  child: Padding(
                    padding: EdgeInsets.all(16),
                    child: Column(
                      crossAxisAlignment: CrossAxisAlignment.start,
                      children: [
                        Text(
                          'Players',
                          style: Theme.of(context).textTheme.titleLarge,
                        ),
                        SizedBox(height: 12),
                        ...List.generate(widget.playerCount, (index) {
                          final submissions = state.submissions.values.toList();
                          final hasSubmission = index < submissions.length;
                          final submission = hasSubmission ? submissions[index] : null;
                          final wordCount = submission?.words.length ?? 0;
                          final isComplete = wordCount == 8;
                          
                          return ListTile(
                            leading: Icon(
                              isComplete ? Icons.check_circle : Icons.pending,
                              color: isComplete ? Colors.green : Colors.grey,
                            ),
                            title: Text(
                              submission?.playerName ?? 'Player ${index + 1}',
                              style: TextStyle(
                                fontWeight: isComplete ? FontWeight.bold : FontWeight.normal,
                              ),
                            ),
                            trailing: Text(
                              '$wordCount / 8',
                              style: TextStyle(
                                fontSize: 16,
                                color: isComplete ? Colors.green : Colors.orange,
                                fontWeight: FontWeight.bold,
                              ),
                            ),
                          );
                        }),
                      ],
                    ),
                  ),
                ),
                
                SizedBox(height: 24),
                
                // Start Button
                SizedBox(
                  width: double.infinity,
                  height: 56,
                  child: ElevatedButton(
                    onPressed: state.isReady ? () => _startGame(state) : null,
                    style: ElevatedButton.styleFrom(
                      backgroundColor: state.isReady ? Colors.green : Colors.grey,
                      disabledBackgroundColor: Colors.grey[300],
                    ),
                    child: Text(
                      state.isReady
                          ? 'START GAME âœ“'
                          : 'WAITING FOR WORDS...',
                      style: TextStyle(
                        fontSize: 18,
                        fontWeight: FontWeight.bold,
                      ),
                    ),
                  ),
                ),
                
                SizedBox(height: 8),
                
                if (!state.isReady)
                  Center(
                    child: Text(
                      'Need ${state.targetWords - state.totalWords} more words',
                      style: TextStyle(color: Colors.grey[600]),
                    ),
                  ),
              ],
            ),
          );
        },
      ),
    );
  }
  
  Future<void> _startGame(SessionState state) async {
    try {
      // Collect all words
      final words = await _service.collectWords(_sessionId!);
      
      // Close session
      await _service.closeSession(_sessionId!);
      
      // Navigate back with words
      Navigator.pop(context, words);
    } catch (e) {
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(content: Text('Error starting game: $e')),
      );
    }
  }
  
  @override
  void dispose() {
    // Clean up session if user backs out
    if (_sessionId != null) {
      _service.deleteSession(_sessionId!);
    }
    super.dispose();
  }
}
```

### 3. Web Interface Implementation

#### 3.1 Firebase Hosting Setup

```bash
# Initialize Firebase hosting
firebase init hosting

# Choose public directory: "public"
# Configure as single-page app: No
# Set up automatic builds: No
```

#### 3.2 Web Page HTML

**public/submit.html:**
```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Add Words - Asocijacije</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .container {
      background: white;
      border-radius: 16px;
      padding: 32px;
      max-width: 500px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 8px;
      font-size: 28px;
    }
    
    .session-code {
      text-align: center;
      color: #667eea;
      font-weight: bold;
      font-size: 18px;
      letter-spacing: 2px;
      margin-bottom: 8px;
    }
    
    .instructions {
      text-align: center;
      color: #666;
      margin-bottom: 24px;
      font-size: 14px;
    }
    
    .progress-bar {
      background: #e0e0e0;
      height: 8px;
      border-radius: 4px;
      margin-bottom: 8px;
      overflow: hidden;
    }
    
    .progress-fill {
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      height: 100%;
      transition: width 0.3s ease;
    }
    
    .progress-text {
      text-align: center;
      color: #666;
      font-size: 14px;
      margin-bottom: 24px;
      font-weight: 600;
    }
    
    .input-group {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }
    
    input[type="text"] {
      flex: 1;
      padding: 14px;
      font-size: 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      transition: border-color 0.3s;
    }
    
    input[type="text"]:focus {
      outline: none;
      border-color: #667eea;
    }
    
    button {
      padding: 14px 24px;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .btn-add {
      background: #667eea;
      color: white;
    }
    
    .btn-add:hover {
      background: #5568d3;
      transform: translateY(-2px);
    }
    
    .btn-add:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }
    
    .word-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 24px;
      min-height: 100px;
      padding: 16px;
      background: #f5f5f5;
      border-radius: 8px;
    }
    
    .word-tag {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 14px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      animation: slideIn 0.3s ease;
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .word-remove {
      cursor: pointer;
      color: #999;
      font-weight: bold;
      font-size: 18px;
      line-height: 1;
      transition: color 0.2s;
    }
    
    .word-remove:hover {
      color: #f44336;
    }
    
    .btn-submit {
      width: 100%;
      padding: 16px;
      background: #4CAF50;
      color: white;
      font-size: 18px;
    }
    
    .btn-submit:hover:not(:disabled) {
      background: #45a049;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    .btn-submit:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }
    
    .status {
      text-align: center;
      margin-top: 16px;
      padding: 16px;
      border-radius: 8px;
      font-weight: 600;
    }
    
    .status.success {
      background: #d4edda;
      color: #155724;
    }
    
    .status.error {
      background: #f8d7da;
      color: #721c24;
    }
    
    .loading {
      text-align: center;
      padding: 40px;
    }
    
    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .empty-state {
      text-align: center;
      color: #999;
      padding: 32px;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="loading" class="loading">
      <div class="spinner"></div>
      <p style="margin-top: 16px; color: #666;">Loading session...</p>
    </div>
    
    <div id="app" style="display: none;">
      <h1>ðŸŽ® Add Your Words!</h1>
      <div class="session-code">Session: <span id="sessionCode"></span></div>
      <p class="instructions">Add exactly 8 words for tonight's game</p>
      
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
      </div>
      <div class="progress-text" id="progressText">0 / 8 words</div>
      
      <div class="input-group">
        <input 
          type="text" 
          id="wordInput" 
          placeholder="Type a word..."
          autocomplete="off"
          autofocus
        >
        <button class="btn-add" id="addBtn" onclick="addWord()">Add</button>
      </div>
      
      <div class="word-list" id="wordList">
        <div class="empty-state">Your words will appear here</div>
      </div>
      
      <button class="btn-submit" id="submitBtn" onclick="submitWords()" disabled>
        Submit Words
      </button>
      
      <div id="status" class="status" style="display: none;"></div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getDatabase, ref, set, get, onValue } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

    // Firebase configuration - REPLACE WITH YOUR CONFIG
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "your-app.firebaseapp.com",
      databaseURL: "https://your-app.firebaseio.com",
      projectId: "your-project-id",
      storageBucket: "your-app.appspot.com",
      messagingSenderId: "123456789",
      appId: "1:123456789:web:abcdef123456"
    };
    
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    
    // Get session ID from URL path
    const pathParts = window.location.pathname.split('/');
    const sessionId = pathParts[pathParts.length - 1] || pathParts[pathParts.length - 2];
    
    // Generate unique player ID
    const playerId = 'player_' + Math.random().toString(36).substr(2, 9);
    
    let words = [];
    const REQUIRED_WORDS = 8;
    
    // Initialize
    document.getElementById('sessionCode').textContent = sessionId;
    
    // Check if session exists
    async function initSession() {
      try {
        const sessionRef = ref(db, `sessions/${sessionId}`);
        const snapshot = await get(sessionRef);
        
        if (!snapshot.exists()) {
          showError('Invalid session code!');
          return;
        }
        
        const sessionData = snapshot.val();
        if (sessionData.status !== 'collecting') {
          showError('This session is no longer accepting words.');
          return;
        }
        
        document.getElementById('loading').style.display = 'none';
        document.getElementById('app').style.display = 'block';
        
        // Listen for session updates
        onValue(sessionRef, (snapshot) => {
          if (!snapshot.exists() || snapshot.val().status !== 'collecting') {
            showError('Session has ended.');
          }
        });
        
      } catch (error) {
        showError('Error loading session: ' + error.message);
      }
    }
    
    initSession();
    
    // Add word function
    window.addWord = function() {
      const input = document.getElementById('wordInput');
      const word = input.value.trim();
      
      if (!word) return;
      
      if (words.length >= REQUIRED_WORDS) {
        alert(`You can only add ${REQUIRED_WORDS} words!`);
        return;
      }
      
      if (words.includes(word.toLowerCase())) {
        alert('You already added that word!');
        input.value = '';
        return;
      }
      
      words.push(word);
      input.value = '';
      input.focus();
      
      renderWords();
      updateProgress();
    }
    
    // Remove word function
    window.removeWord = function(word) {
      words = words.filter(w => w !== word);
      renderWords();
      updateProgress();
    }
    
    // Render word tags
    function renderWords() {
      const container = document.getElementById('wordList');
      
      if (words.length === 0) {
        container.innerHTML = '<div class="empty-state">Your words will appear here</div>';
        return;
      }
      
      container.innerHTML = words.map(word => 
        `<div class="word-tag">
          ${word}
          <span class="word-remove" onclick="removeWord('${word}')">Ã—</span>
        </div>`
      ).join('');
    }
    
    // Update progress bar
    function updateProgress() {
      const progress = (words.length / REQUIRED_WORDS) * 100;
      document.getElementById('progressFill').style.width = progress + '%';
      document.getElementById('progressText').textContent = 
        `${words.length} / ${REQUIRED_WORDS} words`;
      
      // Enable/disable submit button
      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = words.length !== REQUIRED_WORDS;
      
      // Disable add button if limit reached
      const addBtn = document.getElementById('addBtn');
      addBtn.disabled = words.length >= REQUIRED_WORDS;
    }
    
    // Submit words
    window.submitWords = async function() {
      if (words.length !== REQUIRED_WORDS) {
        alert(`Please add exactly ${REQUIRED_WORDS} words!`);
        return;
      }
      
      try {
        const submitBtn = document.getElementById('submitBtn');
        submitBtn.disabled = true;
        submitBtn.textContent = 'Submitting...';
        
        await set(ref(db, `sessions/${sessionId}/words/${playerId}`), {
          words: words,
          submittedAt: Date.now(),
          playerName: null  // Optional: add player name input if desired
        });
        
        showSuccess('âœ“ Words submitted successfully! You can close this page.');
        
        // Disable input
        document.getElementById('wordInput').disabled = true;
        document.getElementById('addBtn').disabled = true;
        
      } catch (error) {
        showError('Error submitting words: ' + error.message);
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit Words';
      }
    }
    
    // Show success message
    function showSuccess(message) {
      const status = document.getElementById('status');
      status.className = 'status success';
      status.textContent = message;
      status.style.display = 'block';
    }
    
    // Show error message
    function showError(message) {
      const status = document.getElementById('status');
      status.className = 'status error';
      status.textContent = message;
      status.style.display = 'block';
      
      document.getElementById('loading').style.display = 'none';
      document.getElementById('app').style.display = 'none';
    }
    
    // Enter key to add word
    document.getElementById('wordInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        addWord();
      }
    });
  </script>
</body>
</html>
```

#### 3.3 Firebase Hosting Configuration

**firebase.json:**
```json
{
  "hosting": {
    "public": "public",
    "ignore": [
      "firebase.json",
      "**/.*",
      "**/node_modules/**"
    ],
    "rewrites": [
      {
        "source": "/submit/**",
        "destination": "/submit.html"
      }
    ]
  }
}
```

#### 3.4 Deploy Web Interface

```bash
# Deploy to Firebase Hosting
firebase deploy --only hosting

# Your URL will be: https://your-project-id.web.app/submit/{sessionId}
# Update this URL in Flutter code (WordCollectionScreen)
```

### 4. Integration with Game Setup

**Example: Adding to game setup flow**

```dart
// In your game setup screen
ElevatedButton(
  onPressed: () async {
    // Navigate to word collection
    final List<String>? customWords = await Navigator.push(
      context,
      MaterialPageRoute(
        builder: (context) => WordCollectionScreen(
          playerCount: playerCount,
        ),
      ),
    );
    
    if (customWords != null && customWords.isNotEmpty) {
      // Use custom words for game
      setState(() {
        gameWords = customWords;
      });
      
      // Start game with custom words
      startGame(gameWords);
    }
  },
  child: Text('Use Custom Words'),
),
```

### 5. Error Handling & Edge Cases

#### 5.1 Session Expiration
```dart
// Cleanup expired sessions (run periodically or on app start)
Future<void> cleanupExpiredSessions() async {
  final now = DateTime.now().millisecondsSinceEpoch;
  final snapshot = await _database.child('sessions').get();
  
  if (snapshot.exists) {
    final sessions = Map<String, dynamic>.from(snapshot.value as Map);
    sessions.forEach((sessionId, data) async {
      final sessionData = Map<String, dynamic>.from(data);
      if (sessionData['expiresAt'] < now) {
        await _database.child('sessions/$sessionId').remove();
      }
    });
  }
}
```

#### 5.2 Duplicate Words
```dart
// Check for duplicate words across all players (optional)
List<String> removeDuplicates(List<String> words) {
  return words.toSet().toList();
}
```

#### 5.3 Inappropriate Content Filter
```dart
// Basic content filter (expand as needed)
bool isWordAppropriate(String word) {
  final inappropriateWords = ['bad', 'word', 'list']; // Expand this
  return !inappropriateWords.contains(word.toLowerCase());
}
```

#### 5.4 No Internet Connection
```dart
// Check connectivity before showing QR screen
import 'package:connectivity_plus/connectivity_plus.dart';

Future<bool> checkConnectivity() async {
  final result = await Connectivity().checkConnectivity();
  return result != ConnectivityResult.none;
}

// In UI
if (!await checkConnectivity()) {
  showDialog(
    context: context,
    builder: (_) => AlertDialog(
      title: Text('No Internet'),
      content: Text('Custom word collection requires internet. Use default words instead?'),
      actions: [
        TextButton(
          onPressed: () => Navigator.pop(context),
          child: Text('Cancel'),
        ),
        TextButton(
          onPressed: () {
            Navigator.pop(context);
            startGameWithDefaultWords();
          },
          child: Text('Use Default Words'),
        ),
      ],
    ),
  );
}
```

### 6. Testing Checklist

- [ ] Firebase project created and configured
- [ ] Flutter app can create sessions
- [ ] QR code generates correctly
- [ ] Web page loads with valid session ID
- [ ] Web page shows error with invalid session ID
- [ ] Words can be added on web interface
- [ ] Words appear in real-time on Flutter app
- [ ] Submit button only enables at exactly 8 words
- [ ] Can't add more than 8 words
- [ ] Duplicate words within same player prevented
- [ ] Progress bar updates correctly
- [ ] Start button only enables when all players submit 8 words each
- [ ] Words collected correctly and passed to game
- [ ] Session cleanup works (expiration, manual delete)
- [ ] Error handling for network issues
- [ ] Multiple players can submit simultaneously
- [ ] Works on different devices (iOS, Android, web browsers)

### 7. Security Considerations

1. **Session expiration:** 30 minutes max
2. **Rate limiting:** Consider Firebase Realtime Database rules to prevent spam
3. **Content filtering:** Add server-side validation if concerned about inappropriate words
4. **Session access:** Read-only access to completed sessions

### 8. Future Enhancements (Optional)

- Player name input on web interface
- Real-time word preview (see what others are adding)
- Word suggestions/autocomplete
- Category selection per player
- Ability to edit submitted words before everyone finishes
- Share session link via SMS/WhatsApp instead of QR only
- Analytics: track most common custom words

### 9. Cost Estimate

**Firebase Free Tier (Spark Plan):**
- Realtime Database: 1GB storage, 10GB/month downloads
- Hosting: 10GB storage, 360MB/day bandwidth
- **Estimated capacity:** 500-1000 games/month easily within free tier

**If you exceed free tier:**
- Blaze (pay-as-you-go) plan
- Realtime Database: $5/GB stored, $1/GB downloaded
- Very low cost for this use case (<$5/month even with heavy use)

---

## Quick Start Summary

1. **Setup Firebase:**
   ```bash
   firebase init
   firebase deploy
   ```

2. **Add packages to pubspec.yaml:**
   ```yaml
   firebase_core, firebase_database, qr_flutter, uuid
   ```

3. **Copy service code:** `word_collection_service.dart`

4. **Copy UI code:** `word_collection_screen.dart`

5. **Deploy web page:** `submit.html` to Firebase Hosting

6. **Update URL:** Replace `https://yourapp.web.app` with your actual Firebase Hosting URL

7. **Test:** Create session â†’ Scan QR â†’ Add words â†’ Start game

---

**Version:** 1.0  
**Last Updated:** January 2026  
**Game:** Asocijacije (Flutter)  
**Feature:** QR Code Custom Word Collection
